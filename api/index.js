import{createRequire as Te}from"node:module";var Ce=Object.create;var{getPrototypeOf:$e,defineProperty:ee,getOwnPropertyNames:Ne}=Object;var Ae=Object.prototype.hasOwnProperty;var Se=(e,t,s)=>{s=e!=null?Ce($e(e)):{};let r=t||!e||!e.__esModule?ee(s,"default",{value:e,enumerable:!0}):s;for(let n of Ne(e))if(!Ae.call(r,n))ee(r,n,{get:()=>e[n],enumerable:!0});return r};var je=Te(import.meta.url);var m=(e,t,s)=>{return(r,n)=>{let o=-1;return i(0);async function i(a){if(a<=o)throw Error("next() called multiple times");o=a;let c,l=!1,f;if(e[a])f=e[a][0][0],r.req.routeIndex=a;else f=a===e.length&&n||void 0;if(f)try{c=await f(r,()=>i(a+1))}catch(u){if(u instanceof Error&&t)r.error=u,c=await t(u,r),l=!0;else throw u}else if(r.finalized===!1&&s)c=await s(r);if(c&&(r.finalized===!1||l))r.res=c;return r}}};var te=Symbol();var se=async(e,t=Object.create(null))=>{let{all:s=!1,dot:r=!1}=t,o=(e instanceof S?e.raw.headers:e.headers).get("Content-Type");if(o?.startsWith("multipart/form-data")||o?.startsWith("application/x-www-form-urlencoded"))return De(e,{all:s,dot:r});return{}};async function De(e,t){let s=await e.formData();if(s)return qe(s,t);return{}}function qe(e,t){let s=Object.create(null);if(e.forEach((r,n)=>{if(!(t.all||n.endsWith("[]")))s[n]=r;else Le(s,n,r)}),t.dot)Object.entries(s).forEach(([r,n])=>{if(r.includes("."))Ie(s,r,n),delete s[r]});return s}var Le=(e,t,s)=>{if(e[t]!==void 0)if(Array.isArray(e[t]))e[t].push(s);else e[t]=[e[t],s];else if(!t.endsWith("[]"))e[t]=s;else e[t]=[s]},Ie=(e,t,s)=>{let r=e,n=t.split(".");n.forEach((o,i)=>{if(i===n.length-1)r[o]=s;else{if(!r[o]||typeof r[o]!=="object"||Array.isArray(r[o])||r[o]instanceof File)r[o]=Object.create(null);r=r[o]}})};var K=(e)=>{let t=e.split("/");if(t[0]==="")t.shift();return t},re=(e)=>{let{groups:t,path:s}=_e(e),r=K(s);return Be(r,t)},_e=(e)=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(s,r)=>{let n=`@${r}`;return t.push([n,s]),n}),{groups:t,path:e}},Be=(e,t)=>{for(let s=t.length-1;s>=0;s--){let[r]=t[s];for(let n=e.length-1;n>=0;n--)if(e[n].includes(r)){e[n]=e[n].replace(r,t[s][1]);break}}return e},T={},ne=(e,t)=>{if(e==="*")return"*";let s=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(s){let r=`${e}#${t}`;if(!T[r])if(s[2])T[r]=t&&t[0]!==":"&&t[0]!=="*"?[r,s[1],new RegExp(`^${s[2]}(?=/${t})`)]:[e,s[1],new RegExp(`^${s[2]}$`)];else T[r]=[e,s[1],!0];return T[r]}return null},j=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,(s)=>{try{return t(s)}catch{return s}})}},Fe=(e)=>j(e,decodeURI),z=(e)=>{let t=e.url,s=t.indexOf("/",t.indexOf(":")+4),r=s;for(;r<t.length;r++){let n=t.charCodeAt(r);if(n===37){let o=t.indexOf("?",r),i=t.slice(s,o===-1?void 0:o);return Fe(i.includes("%25")?i.replace(/%25/g,"%2525"):i)}else if(n===63)break}return t.slice(s,r)};var oe=(e)=>{let t=z(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},P=(e,t,...s)=>{if(s.length)t=P(t,...s);return`${e?.[0]==="/"?"":"/"}${e}${t==="/"?"":`${e?.at(-1)==="/"?"":"/"}${t?.[0]==="/"?t.slice(1):t}`}`},D=(e)=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;let t=e.split("/"),s=[],r="";return t.forEach((n)=>{if(n!==""&&!/\:/.test(n))r+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){if(s.length===0&&r==="")s.push("/");else s.push(r);let o=n.replace("?","");r+="/"+o,s.push(r)}else r+="/"+n}),s.filter((n,o,i)=>i.indexOf(n)===o)},V=(e)=>{if(!/[%+]/.test(e))return e;if(e.indexOf("+")!==-1)e=e.replace(/\+/g," ");return e.indexOf("%")!==-1?j(e,U):e},ie=(e,t,s)=>{let r;if(!s&&t&&!/[%+]/.test(t)){let i=e.indexOf(`?${t}`,8);if(i===-1)i=e.indexOf(`&${t}`,8);while(i!==-1){let a=e.charCodeAt(i+t.length+1);if(a===61){let c=i+t.length+2,l=e.indexOf("&",c);return V(e.slice(c,l===-1?void 0:l))}else if(a==38||isNaN(a))return"";i=e.indexOf(`&${t}`,i+1)}if(r=/[%+]/.test(e),!r)return}let n={};r??=/[%+]/.test(e);let o=e.indexOf("?",8);while(o!==-1){let i=e.indexOf("&",o+1),a=e.indexOf("=",o);if(a>i&&i!==-1)a=-1;let c=e.slice(o+1,a===-1?i===-1?void 0:i:a);if(r)c=V(c);if(o=i,c==="")continue;let l;if(a===-1)l="";else if(l=e.slice(a+1,i===-1?void 0:i),r)l=V(l);if(s){if(!(n[c]&&Array.isArray(n[c])))n[c]=[];n[c].push(l)}else n[c]??=l}return t?n[t]:n},ce=ie,ae=(e,t)=>{return ie(e,t,!0)},U=decodeURIComponent;var le=(e)=>j(e,U),S=class{raw;#t;#e;routeIndex=0;path;bodyCache={};constructor(e,t="/",s=[[]]){this.raw=e,this.path=t,this.#e=s,this.#t={}}param(e){return e?this.#s(e):this.#o()}#s(e){let t=this.#e[0][this.routeIndex][1][e],s=this.#n(t);return s&&/\%/.test(s)?le(s):s}#o(){let e={},t=Object.keys(this.#e[0][this.routeIndex][1]);for(let s of t){let r=this.#n(this.#e[0][this.routeIndex][1][s]);if(r!==void 0)e[s]=/\%/.test(r)?le(r):r}return e}#n(e){return this.#e[1]?this.#e[1][e]:e}query(e){return ce(this.url,e)}queries(e){return ae(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;let t={};return this.raw.headers.forEach((s,r)=>{t[r]=s}),t}async parseBody(e){return this.bodyCache.parsedBody??=await se(this,e)}#r=(e)=>{let{bodyCache:t,raw:s}=this,r=t[e];if(r)return r;let n=Object.keys(t)[0];if(n)return t[n].then((o)=>{if(n==="json")o=JSON.stringify(o);return new Response(o)[e]()});return t[e]=s[e]()};json(){return this.#r("text").then((e)=>JSON.parse(e))}text(){return this.#r("text")}arrayBuffer(){return this.#r("arrayBuffer")}blob(){return this.#r("blob")}formData(){return this.#r("formData")}addValidatedData(e,t){this.#t[e]=t}valid(e){return this.#t[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[te](){return this.#e}get matchedRoutes(){return this.#e[0].map(([[,e]])=>e)}get routePath(){return this.#e[0].map(([[,e]])=>e)[this.routeIndex].path}};var fe={Stringify:1,BeforeStream:2,Stream:3},me=(e,t)=>{let s=new String(e);return s.isEscaped=!0,s.callbacks=t,s};var W=async(e,t,s,r,n)=>{if(typeof e==="object"&&!(e instanceof String)){if(!(e instanceof Promise))e=e.toString();if(e instanceof Promise)e=await e}let o=e.callbacks;if(!o?.length)return Promise.resolve(e);if(n)n[0]+=e;else n=[e];let i=Promise.all(o.map((a)=>a({phase:t,buffer:n,context:r}))).then((a)=>Promise.all(a.filter(Boolean).map((c)=>W(c,t,!1,r,n))).then(()=>n[0]));if(s)return me(await i,o);else return i};var Ve="text/plain; charset=UTF-8",Q=(e,t)=>{return{"Content-Type":e,...t}},ue=class{#t;#e;env={};#s;finalized=!1;error;#o;#n;#r;#f;#a;#l;#c;#u;#h;constructor(e,t){if(this.#t=e,t)this.#n=t.executionCtx,this.env=t.env,this.#l=t.notFoundHandler,this.#h=t.path,this.#u=t.matchResult}get req(){return this.#e??=new S(this.#t,this.#h,this.#u),this.#e}get event(){if(this.#n&&"respondWith"in this.#n)return this.#n;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#n)return this.#n;else throw Error("This context has no ExecutionContext")}get res(){return this.#r||=new Response(null,{headers:this.#c??=new Headers})}set res(e){if(this.#r&&e){e=new Response(e.body,e);for(let[t,s]of this.#r.headers.entries()){if(t==="content-type")continue;if(t==="set-cookie"){let r=this.#r.headers.getSetCookie();e.headers.delete("set-cookie");for(let n of r)e.headers.append("set-cookie",n)}else e.headers.set(t,s)}}this.#r=e,this.finalized=!0}render=(...e)=>{return this.#a??=(t)=>this.html(t),this.#a(...e)};setLayout=(e)=>this.#f=e;getLayout=()=>this.#f;setRenderer=(e)=>{this.#a=e};header=(e,t,s)=>{if(this.finalized)this.#r=new Response(this.#r.body,this.#r);let r=this.#r?this.#r.headers:this.#c??=new Headers;if(t===void 0)r.delete(e);else if(s?.append)r.append(e,t);else r.set(e,t)};status=(e)=>{this.#o=e};set=(e,t)=>{this.#s??=new Map,this.#s.set(e,t)};get=(e)=>{return this.#s?this.#s.get(e):void 0};get var(){if(!this.#s)return{};return Object.fromEntries(this.#s)}#i(e,t,s){let r=this.#r?new Headers(this.#r.headers):this.#c??new Headers;if(typeof t==="object"&&"headers"in t){let o=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(let[i,a]of o)if(i.toLowerCase()==="set-cookie")r.append(i,a);else r.set(i,a)}if(s)for(let[o,i]of Object.entries(s))if(typeof i==="string")r.set(o,i);else{r.delete(o);for(let a of i)r.append(o,a)}let n=typeof t==="number"?t:t?.status??this.#o;return new Response(e,{status:n,headers:r})}newResponse=(...e)=>this.#i(...e);body=(e,t,s)=>this.#i(e,t,s);text=(e,t,s)=>{return!this.#c&&!this.#o&&!t&&!s&&!this.finalized?new Response(e):this.#i(e,t,Q(Ve,s))};json=(e,t,s)=>{return this.#i(JSON.stringify(e),t,Q("application/json",s))};html=(e,t,s)=>{let r=(n)=>this.#i(n,t,Q("text/html; charset=UTF-8",s));return typeof e==="object"?W(e,fe.Stringify,!1,{}).then(r):r(e)};redirect=(e,t)=>{let s=String(e);return this.header("Location",!/[^\x00-\xFF]/.test(s)?s:encodeURI(s)),this.newResponse(null,t??302)};notFound=()=>{return this.#l??=()=>new Response,this.#l(this)}};var h="ALL",he="all",de=["get","post","put","delete","options","patch"],q="Can not add a route since the matcher is already built.",L=class extends Error{};var ge="__COMPOSED_HANDLER";var Ke=(e)=>{return e.text("404 Not Found",404)},xe=(e,t)=>{if("getResponse"in e){let s=e.getResponse();return t.newResponse(s.body,s)}return console.error(e),t.text("Internal Server Error",500)},G=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#t="/";routes=[];constructor(e={}){[...de,he].forEach((n)=>{this[n]=(o,...i)=>{if(typeof o==="string")this.#t=o;else this.#o(n,this.#t,o);return i.forEach((a)=>{this.#o(n,this.#t,a)}),this}}),this.on=(n,o,...i)=>{for(let a of[o].flat()){this.#t=a;for(let c of[n].flat())i.map((l)=>{this.#o(c.toUpperCase(),this.#t,l)})}return this},this.use=(n,...o)=>{if(typeof n==="string")this.#t=n;else this.#t="*",o.unshift(n);return o.forEach((i)=>{this.#o(h,this.#t,i)}),this};let{strict:s,...r}=e;Object.assign(this,r),this.getPath=s??!0?e.getPath??z:oe}#e(){let e=new G({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,e.#s=this.#s,e.routes=this.routes,e}#s=Ke;errorHandler=xe;route(e,t){let s=this.basePath(e);return t.routes.map((r)=>{let n;if(t.errorHandler===xe)n=r.handler;else n=async(o,i)=>(await m([],t.errorHandler)(o,()=>r.handler(o,i))).res,n[ge]=r.handler;s.#o(r.method,r.path,n)}),this}basePath(e){let t=this.#e();return t._basePath=P(this._basePath,e),t}onError=(e)=>{return this.errorHandler=e,this};notFound=(e)=>{return this.#s=e,this};mount(e,t,s){let r,n;if(s)if(typeof s==="function")n=s;else if(n=s.optionHandler,s.replaceRequest===!1)r=(a)=>a;else r=s.replaceRequest;let o=n?(a)=>{let c=n(a);return Array.isArray(c)?c:[c]}:(a)=>{let c=void 0;try{c=a.executionCtx}catch{}return[a.env,c]};r||=(()=>{let a=P(this._basePath,e),c=a==="/"?0:a.length;return(l)=>{let f=new URL(l.url);return f.pathname=f.pathname.slice(c)||"/",new Request(f,l)}})();let i=async(a,c)=>{let l=await t(r(a.req.raw),...o(a));if(l)return l;await c()};return this.#o(h,P(e,"*"),i),this}#o(e,t,s){e=e.toUpperCase(),t=P(this._basePath,t);let r={basePath:this._basePath,path:t,method:e,handler:s};this.router.add(e,t,[s,r]),this.routes.push(r)}#n(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e}#r(e,t,s,r){if(r==="HEAD")return(async()=>new Response(null,await this.#r(e,t,s,"GET")))();let n=this.getPath(e,{env:s}),o=this.router.match(r,n),i=new ue(e,{path:n,matchResult:o,env:s,executionCtx:t,notFoundHandler:this.#s});if(o[0].length===1){let c;try{c=o[0][0][0][0](i,async()=>{i.res=await this.#s(i)})}catch(l){return this.#n(l,i)}return c instanceof Promise?c.then((l)=>l||(i.finalized?i.res:this.#s(i))).catch((l)=>this.#n(l,i)):c??this.#s(i)}let a=m(o[0],this.errorHandler,this.#s);return(async()=>{try{let c=await a(i);if(!c.finalized)throw Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return this.#n(c,i)}})()}fetch=(e,...t)=>{return this.#r(e,t[1],t[0],e.method)};request=(e,t,s,r)=>{if(e instanceof Request)return this.fetch(t?new Request(e,t):e,s,r);return e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${P("/",e)}`,t),s,r)};fire=()=>{addEventListener("fetch",(e)=>{e.respondWith(this.#r(e.request,e,void 0,e.request.method))})}};var I="[^/]+",$=".*",N="(?:|/.*)",R=Symbol(),ze=new Set(".\\+*[^]$()");function Ue(e,t){if(e.length===1)return t.length===1?e<t?-1:1:-1;if(t.length===1)return 1;if(e===$||e===N)return 1;else if(t===$||t===N)return-1;if(e===I)return 1;else if(t===I)return-1;return e.length===t.length?e<t?-1:1:t.length-e.length}var _=class{#t;#e;#s=Object.create(null);insert(e,t,s,r,n){if(e.length===0){if(this.#t!==void 0)throw R;if(n)return;this.#t=t;return}let[o,...i]=e,a=o==="*"?i.length===0?["","",$]:["","",I]:o==="/*"?["","",N]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(a){let l=a[1],f=a[2]||I;if(l&&a[2]){if(f===".*")throw R;if(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f))throw R}if(c=this.#s[f],!c){if(Object.keys(this.#s).some((u)=>u!==$&&u!==N))throw R;if(n)return;if(c=this.#s[f]=new _,l!=="")c.#e=r.varIndex++}if(!n&&l!=="")s.push([l,c.#e])}else if(c=this.#s[o],!c){if(Object.keys(this.#s).some((l)=>l.length>1&&l!==$&&l!==N))throw R;if(n)return;c=this.#s[o]=new _}c.insert(i,t,s,r,n)}buildRegExpStr(){let t=Object.keys(this.#s).sort(Ue).map((s)=>{let r=this.#s[s];return(typeof r.#e==="number"?`(${s})@${r.#e}`:ze.has(s)?`\\${s}`:s)+r.buildRegExpStr()});if(typeof this.#t==="number")t.unshift(`#${this.#t}`);if(t.length===0)return"";if(t.length===1)return t[0];return"(?:"+t.join("|")+")"}};var pe=class{#t={varIndex:0};#e=new _;insert(e,t,s){let r=[],n=[];for(let i=0;;){let a=!1;if(e=e.replace(/\{[^}]+\}/g,(c)=>{let l=`@\\${i}`;return n[i]=[l,c],i++,a=!0,l}),!a)break}let o=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let i=n.length-1;i>=0;i--){let[a]=n[i];for(let c=o.length-1;c>=0;c--)if(o[c].indexOf(a)!==-1){o[c]=o[c].replace(a,n[i][1]);break}}return this.#e.insert(o,t,r,this.#t,s),r}buildRegExp(){let e=this.#e.buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0,s=[],r=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,o,i)=>{if(o!==void 0)return s[++t]=Number(o),"$()";if(i!==void 0)return r[Number(i)]=++t,"";return""}),[new RegExp(`^${e}`),s,r]}};var ye=[],We=[/^$/,[],Object.create(null)],ve=Object.create(null);function we(e){return ve[e]??=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,s)=>s?`\\${s}`:"(?:|/.*)")}$`)}function Qe(){ve=Object.create(null)}function Ge(e){let t=new pe,s=[];if(e.length===0)return We;let r=e.map((l)=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,f],[u,g])=>l?1:u?-1:f.length-g.length),n=Object.create(null);for(let l=0,f=-1,u=r.length;l<u;l++){let[g,p,d]=r[l];if(g)n[p]=[d.map(([y])=>[y,Object.create(null)]),ye];else f++;let x;try{x=t.insert(p,f,g)}catch(y){throw y===R?new L(p):y}if(g)continue;s[f]=d.map(([y,H])=>{let O=Object.create(null);H-=1;for(;H>=0;H--){let[v,F]=x[H];O[v]=F}return[y,O]})}let[o,i,a]=t.buildRegExp();for(let l=0,f=s.length;l<f;l++)for(let u=0,g=s[l].length;u<g;u++){let p=s[l][u]?.[1];if(!p)continue;let d=Object.keys(p);for(let x=0,y=d.length;x<y;x++)p[d[x]]=a[p[d[x]]]}let c=[];for(let l in i)c[l]=s[i[l]];return[o,c,n]}function E(e,t){if(!e)return;for(let s of Object.keys(e).sort((r,n)=>n.length-r.length))if(we(s).test(t))return[...e[s]];return}var X=class{name="RegExpRouter";#t;#e;constructor(){this.#t={[h]:Object.create(null)},this.#e={[h]:Object.create(null)}}add(e,t,s){let r=this.#t,n=this.#e;if(!r||!n)throw Error(q);if(!r[e])[r,n].forEach((a)=>{a[e]=Object.create(null),Object.keys(a[h]).forEach((c)=>{a[e][c]=[...a[h][c]]})});if(t==="/*")t="*";let o=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let a=we(t);if(e===h)Object.keys(r).forEach((c)=>{r[c][t]||=E(r[c],t)||E(r[h],t)||[]});else r[e][t]||=E(r[e],t)||E(r[h],t)||[];Object.keys(r).forEach((c)=>{if(e===h||e===c)Object.keys(r[c]).forEach((l)=>{a.test(l)&&r[c][l].push([s,o])})}),Object.keys(n).forEach((c)=>{if(e===h||e===c)Object.keys(n[c]).forEach((l)=>a.test(l)&&n[c][l].push([s,o]))});return}let i=D(t)||[t];for(let a=0,c=i.length;a<c;a++){let l=i[a];Object.keys(n).forEach((f)=>{if(e===h||e===f)n[f][l]||=[...E(r[f],l)||E(r[h],l)||[]],n[f][l].push([s,o-c+a+1])})}}match(e,t){Qe();let s=this.#s();return this.match=(r,n)=>{let o=s[r]||s[h],i=o[2][n];if(i)return i;let a=n.match(o[0]);if(!a)return[[],ye];let c=a.indexOf("",1);return[o[1][c],a]},this.match(e,t)}#s(){let e=Object.create(null);return Object.keys(this.#e).concat(Object.keys(this.#t)).forEach((t)=>{e[t]||=this.#o(t)}),this.#t=this.#e=void 0,e}#o(e){let t=[],s=e===h;if([this.#t,this.#e].forEach((r)=>{let n=r[e]?Object.keys(r[e]).map((o)=>[o,r[e][o]]):[];if(n.length!==0)s||=!0,t.push(...n);else if(e!==h)t.push(...Object.keys(r[h]).map((o)=>[o,r[h][o]]))}),!s)return null;else return Ge(t)}};var k=class{name="SmartRouter";#t=[];#e=[];constructor(e){this.#t=e.routers}add(e,t,s){if(!this.#e)throw Error(q);this.#e.push([e,t,s])}match(e,t){if(!this.#e)throw Error("Fatal error");let s=this.#t,r=this.#e,n=s.length,o=0,i;for(;o<n;o++){let a=s[o];try{for(let c=0,l=r.length;c<l;c++)a.add(...r[c]);i=a.match(e,t)}catch(c){if(c instanceof L)continue;throw c}this.match=a.match.bind(a),this.#t=[a],this.#e=void 0;break}if(o===n)throw Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,i}get activeRouter(){if(this.#e||this.#t.length!==1)throw Error("No active router has been determined yet.");return this.#t[0]}};var A=Object.create(null),J=class{#t;#e;#s;#o=0;#n=A;constructor(e,t,s){if(this.#e=s||Object.create(null),this.#t=[],e&&t){let r=Object.create(null);r[e]={handler:t,possibleKeys:[],score:0},this.#t=[r]}this.#s=[]}insert(e,t,s){this.#o=++this.#o;let r=this,n=re(t),o=[];for(let i=0,a=n.length;i<a;i++){let c=n[i],l=n[i+1],f=ne(c,l),u=Array.isArray(f)?f[0]:c;if(u in r.#e){if(r=r.#e[u],f)o.push(f[1]);continue}if(r.#e[u]=new J,f)r.#s.push(f),o.push(f[1]);r=r.#e[u]}return r.#t.push({[e]:{handler:s,possibleKeys:o.filter((i,a,c)=>c.indexOf(i)===a),score:this.#o}}),r}#r(e,t,s,r){let n=[];for(let o=0,i=e.#t.length;o<i;o++){let a=e.#t[o],c=a[t]||a[h],l={};if(c!==void 0){if(c.params=Object.create(null),n.push(c),s!==A||r&&r!==A)for(let f=0,u=c.possibleKeys.length;f<u;f++){let g=c.possibleKeys[f],p=l[c.score];c.params[g]=r?.[g]&&!p?r[g]:s[g]??r?.[g],l[c.score]=!0}}}return n}search(e,t){let s=[];this.#n=A;let n=[this],o=K(t),i=[];for(let a=0,c=o.length;a<c;a++){let l=o[a],f=a===c-1,u=[];for(let g=0,p=n.length;g<p;g++){let d=n[g],x=d.#e[l];if(x)if(x.#n=d.#n,f){if(x.#e["*"])s.push(...this.#r(x.#e["*"],e,d.#n));s.push(...this.#r(x,e,d.#n))}else u.push(x);for(let y=0,H=d.#s.length;y<H;y++){let O=d.#s[y],v=d.#n===A?{}:{...d.#n};if(O==="*"){let b=d.#e["*"];if(b)s.push(...this.#r(b,e,d.#n)),b.#n=v,u.push(b);continue}let[F,M,C]=O;if(!l&&!(C instanceof RegExp))continue;let w=d.#e[F],Ee=o.slice(a).join("/");if(C instanceof RegExp){let b=C.exec(Ee);if(b){if(v[M]=b[0],s.push(...this.#r(w,e,d.#n,v)),Object.keys(w.#e).length){w.#n=v;let Oe=b[0].match(/\//)?.length??0;(i[Oe]||=[]).push(w)}continue}}if(C===!0||C.test(l))if(v[M]=l,f){if(s.push(...this.#r(w,e,v,d.#n)),w.#e["*"])s.push(...this.#r(w.#e["*"],e,v,d.#n))}else w.#n=v,u.push(w)}}n=u.concat(i.shift()??[])}if(s.length>1)s.sort((a,c)=>{return a.score-c.score});return[s.map(({handler:a,params:c})=>[a,c])]}};var Z=class{name="TrieRouter";#t;constructor(){this.#t=new J}add(e,t,s){let r=D(t);if(r){for(let n=0,o=r.length;n<o;n++)this.#t.insert(e,r[n],s);return}this.#t.insert(e,t,s)}match(e,t){return this.#t.search(e,t)}};var Y=class extends G{constructor(e={}){super(e);this.router=e.router??new k({routers:[new X,new Z]})}};var be=(e)=>{let s={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},r=((o)=>{if(typeof o==="string")if(o==="*")return()=>o;else return(i)=>o===i?i:null;else if(typeof o==="function")return o;else return(i)=>o.includes(i)?i:null})(s.origin),n=((o)=>{if(typeof o==="function")return o;else if(Array.isArray(o))return()=>o;else return()=>[]})(s.allowMethods);return async function(i,a){function c(f,u){i.res.headers.set(f,u)}let l=await r(i.req.header("origin")||"",i);if(l)c("Access-Control-Allow-Origin",l);if(s.origin!=="*"){let f=i.req.header("Vary");if(f)c("Vary",f);else c("Vary","Origin")}if(s.credentials)c("Access-Control-Allow-Credentials","true");if(s.exposeHeaders?.length)c("Access-Control-Expose-Headers",s.exposeHeaders.join(","));if(i.req.method==="OPTIONS"){if(s.maxAge!=null)c("Access-Control-Max-Age",s.maxAge.toString());let f=await n(i.req.header("origin")||"",i);if(f.length)c("Access-Control-Allow-Methods",f.join(","));let u=s.allowHeaders;if(!u?.length){let g=i.req.header("Access-Control-Request-Headers");if(g)u=g.split(/\s*,\s*/)}if(u?.length)c("Access-Control-Allow-Headers",u.join(",")),i.res.headers.append("Vary","Access-Control-Request-Headers");return i.res.headers.delete("Content-Length"),i.res.headers.delete("Content-Type"),new Response(null,{headers:i.res.headers,status:204,statusText:"No Content"})}await a()}};function Xe(){let{process:e,Deno:t}=globalThis;return!(typeof t?.noColor==="boolean"?t.noColor:e!==void 0?"NO_COLOR"in e?.env:!1)}async function Pe(){let{navigator:e}=globalThis,t="cloudflare:workers";return!(e!==void 0&&e.userAgent==="Cloudflare-Workers"?await(async()=>{try{return"NO_COLOR"in((await import("cloudflare:workers")).env??{})}catch{return!1}})():!Xe())}var ke=(e)=>{let[t,s]=[",","."];return e.map((n)=>n.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+t)).join(s)},Je=(e)=>{let t=Date.now()-e;return ke([t<1000?t+"ms":Math.round(t/1000)+"s"])},Ze=async(e)=>{if(await Pe())switch(e/100|0){case 5:return`\x1B[31m${e}\x1B[0m`;case 4:return`\x1B[33m${e}\x1B[0m`;case 3:return`\x1B[36m${e}\x1B[0m`;case 2:return`\x1B[32m${e}\x1B[0m`}return`${e}`};async function Re(e,t,s,r,n=0,o){let i=t==="<--"?`${t} ${s} ${r}`:`${t} ${s} ${r} ${await Ze(n)} ${o}`;e(i)}var He=(e=console.log)=>{return async function(s,r){let{method:n,url:o}=s.req,i=o.slice(o.indexOf("/",8));await Re(e,"<--",n,i);let a=Date.now();await r(),await Re(e,"-->",n,i,s.res.status,Je(a))}};var B=new Y().basePath("/api");if(!process.env.VERCEL)B.use(be({origin:"*"})),B.use(He());B.get("/hello",(e)=>{return e.text("Hello Hono!")});var ps=B;export{ps as default};
